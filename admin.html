<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Al Qalam Book Center</title>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS Base -->
    <link rel="stylesheet" href="style.css">

    <style>
        :root {
            --sidebar-width: 250px;
            --admin-bg: #F8FAFC;
        }

        body {
            background-color: var(--admin-bg);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-blue);
            color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            background: white;
            color: var(--primary-blue);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .sidebar-brand h2 {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            margin: 0;
            color: white;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-label {
            padding: 0 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover,
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary-green);
        }

        .nav-item i {
            width: 20px;
            margin-right: 15px;
            font-size: 1.1rem;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-info div {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-info span {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-navbar {
            background-color: white;
            height: 70px;
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
            z-index: 10;
        }

        .nav-title {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            color: var(--text-dark);
            margin: 0;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
        }

        .action-btn:hover {
            color: var(--primary-blue);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #E74C3C;
            color: white;
            font-size: 0.6rem;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Dashboard View */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: var(--radius-md);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .stat-info h4 {
            color: var(--text-muted);
            font-size: 0.85rem;
            font-family: var(--font-body);
            font-weight: 500;
            margin-bottom: 5px;
        }

        .stat-info .value {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            color: var(--text-dark);
            font-weight: 700;
        }

        .stat-info .trend {
            font-size: 0.8rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend.up {
            color: var(--primary-green);
        }

        .trend.down {
            color: #E74C3C;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .icon-blue {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }

        .icon-green {
            background-color: var(--light-green);
            color: var(--primary-green);
        }

        .icon-gold {
            background-color: #FFF8E1;
            color: var(--accent-gold);
        }

        .icon-red {
            background-color: #FDEDEC;
            color: #E74C3C;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background-color: white;
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .panel-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            margin: 0;
            color: var(--primary-blue);
        }

        /* Generic Table Config */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        td {
            font-size: 0.95rem;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: var(--radius-pill);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-completed {
            background-color: var(--light-green);
            color: var(--primary-green);
        }

        .status-pending {
            background-color: #FFF8E1;
            color: var(--accent-gold);
        }

        .status-low {
            background-color: #FDEDEC;
            color: #E74C3C;
        }

        /* View toggling */
        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        /* Forms in Admin */
        .admin-form .form-group {
            margin-bottom: 15px;
        }

        .admin-form input,
        .admin-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><i class="fa-solid fa-book-open-reader"></i></div>
            <div class="sidebar-brand">
                <h2>Al Qalam</h2>
                <span style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Admin Console</span>
            </div>
        </div>

        <div class="sidebar-menu">
            <div class="menu-label">Main</div>
            <a class="nav-item active" data-view="dashboard">
                <i class="fa-solid fa-chart-pie"></i> Dashboard
            </a>
            <a class="nav-item" data-view="orders">
                <i class="fa-solid fa-cart-shopping"></i> Orders
            </a>

            <div class="menu-label" style="margin-top: 20px;">Inventory</div>
            <a class="nav-item" data-view="products">
                <i class="fa-solid fa-box-open"></i> Products Mgt.
            </a>
            <a class="nav-item" data-view="low-stock">
                <i class="fa-solid fa-triangle-exclamation"></i> Low Stock Alerts
            </a>

            <div class="menu-label" style="margin-top: 20px;">Management</div>
            <a class="nav-item" data-view="customers">
                <i class="fa-solid fa-users"></i> Customers
            </a>
            <a class="nav-item" data-view="coupons">
                <i class="fa-solid fa-ticket"></i> Coupons
            </a>
            <a class="nav-item" data-view="store-settings">
                <i class="fa-solid fa-bullhorn"></i> Store Settings
            </a>
            <a class="nav-item" data-view="about-us">
                <i class="fa-solid fa-address-card"></i> About Us
            </a>
            <a class="nav-item" href="index.html" target="_blank">
                <i class="fa-solid fa-arrow-up-right-from-square"></i> Go to Store
            </a>
        </div>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">H</div>
                <div class="user-info">
                    <div>Hamid Ali</div>
                    <span>Owner / Admin</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Nav -->
        <header class="top-navbar">
            <h2 class="nav-title" id="pageTitle">Overview</h2>

            <div class="nav-actions">
                <button class="action-btn">
                    <i class="fa-solid fa-search"></i>
                </button>
                <button class="action-btn">
                    <i class="fa-regular fa-bell"></i>
                    <div class="notification-badge">3</div>
                </button>
            </div>
        </header>

        <!-- Content Views -->
        <div class="content-area">

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h4>Total Sales (Today)</h4>
                            <div class="value">Rs 45,500</div>
                            <div class="trend up"><i class="fa-solid fa-arrow-trend-up"></i> +12.5% from yesterday</div>
                        </div>
                        <div class="stat-icon icon-blue"><i class="fa-solid fa-wallet"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h4>Total Orders</h4>
                            <div class="value" id="dashboardTotalOrders">0</div>
                            <div class="trend up"><i class="fa-solid fa-arrow-trend-up"></i> Lifetime</div>
                        </div>
                        <div class="stat-icon icon-green"><i class="fa-solid fa-cart-arrow-down"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h4>Pending Orders</h4>
                            <div class="value" id="dashboardPendingOrders">0</div>
                            <div class="trend pending" style="color: var(--accent-gold);"><i
                                    class="fa-solid fa-clock"></i> Action required</div>
                        </div>
                        <div class="stat-icon icon-gold"><i class="fa-solid fa-hourglass-half"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h4>Low Stock Items</h4>
                            <div class="value">12</div>
                            <div class="trend down"><i class="fa-solid fa-circle-exclamation"></i> Requires attention
                            </div>
                        </div>
                        <div class="stat-icon icon-red"><i class="fa-solid fa-box"></i></div>
                    </div>
                </div>

                <div class="dashboard-container">
                    <!-- Chart Panel -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Sales Analytics Overview</h3>
                            <select style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
                                <option>Last 7 Days</option>
                                <option>This Month</option>
                                <option>This Year</option>
                            </select>
                        </div>
                        <canvas id="salesChart" height="250"></canvas>
                    </div>

                    <!-- Recent Orders Panel -->
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Recent Orders</h3>
                            <a href="#" class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;">View
                                All</a>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersTable">
                                <!-- JS Injected -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Management View -->
            <div id="orders-view" class="view-section">
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">All Customer Orders</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>City</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allOrdersTable">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Management View -->
            <div id="products-view" class="view-section">
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Inventory Management</h3>
                        <button class="btn btn-primary" onclick="openProductModal()">+ Add New Product</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Product Details</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Product Modal -->
            <div id="productModal"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center;">
                <div class="panel" style="width: 500px; max-width: 90%; max-height: 90vh; overflow-y: auto;">
                    <div class="panel-header">
                        <h3 class="panel-title" id="productModalTitle">Add Product</h3>
                        <button type="button" onclick="closeProductModal()"
                            style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                    </div>
                    <form class="admin-form" id="productForm">
                        <input type="hidden" id="prodId">
                        <div class="form-group">
                            <label>Product Title</label>
                            <input type="text" id="prodTitle" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="prodCategory" required>
                                <option value="school">School Books</option>
                                <option value="college">College Books</option>
                                <option value="stationery">Stationery</option>
                                <option value="sets">Complete Sets</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Price (Rs)</label>
                                <input type="number" id="prodPrice" required>
                            </div>
                            <div class="form-group">
                                <label>Old Price (Optional Rs)</label>
                                <input type="number" id="prodOldPrice">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Stock Quantity</label>
                                <input type="number" id="prodStock" required>
                            </div>
                            <div class="form-group">
                                <label>Badge (Optional)</label>
                                <input type="text" id="prodBadge" placeholder="e.g. Best Seller">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Image URL</label>
                            <input type="url" id="prodImg" required placeholder="https://example.com/image.jpg">
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn" style="background: #e2e8f0; color: #475569; flex: 1;"
                                onclick="closeProductModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="flex: 2;">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Customers View -->
            <div id="customers-view" class="view-section">
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Customer Database</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact (WhatsApp)</th>
                                <th>City</th>
                                <th>Total Orders</th>
                            </tr>
                        </thead>
                        <tbody id="customersTable">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Coupons View -->
            <div id="coupons-view" class="view-section">
                <div class="dashboard-container" style="grid-template-columns: 1fr 2fr;">
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Create New Coupon</h3>
                        </div>
                        <form class="admin-form" onsubmit="event.preventDefault(); alert('Coupon Created!');">
                            <div class="form-group">
                                <label>Coupon Code</label>
                                <input type="text" placeholder="e.g. BACK2SCHOOL10" required>
                            </div>
                            <div class="form-group">
                                <label>Discount Percentage (%)</label>
                                <input type="number" placeholder="10" required>
                            </div>
                            <div class="form-group">
                                <label>Expiry Date</label>
                                <input type="date" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Generate Code</button>
                        </form>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Active Coupons</h3>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Discount</th>
                                    <th>Valid Until</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>SPRING15</strong></td>
                                    <td>15%</td>
                                    <td>2026-04-30</td>
                                    <td><span class="status-badge status-completed">Active</span></td>
                                </tr>
                                <tr>
                                    <td><strong>ALQALAM5</strong></td>
                                    <td>5%</td>
                                    <td>2026-12-31</td>
                                    <td><span class="status-badge status-completed">Active</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Store Settings View -->
            <div id="store-settings-view" class="view-section">
                <form class="admin-form" id="storeSettingsForm">
                    <div class="dashboard-container" style="grid-template-columns: 1fr 1fr;">
                        <!-- General Settings Panel -->
                        <div class="panel">
                            <div class="panel-header">
                                <h3 class="panel-title">General Settings</h3>
                            </div>
                            <div class="form-group">
                                <label>Header Announcement</label>
                                <input type="text" id="settingAnnouncement"
                                    placeholder="e.g. New stock arrived! 20% off...">
                            </div>
                            <div class="form-group">
                                <label>Logo Text (Primary)</label>
                                <input type="text" id="settingLogoPrimary" placeholder="e.g. Al Qalam">
                            </div>
                            <div class="form-group">
                                <label>Logo Text (Secondary)</label>
                                <input type="text" id="settingLogoSecondary" placeholder="e.g. Book Center">
                            </div>
                            <div class="form-group">
                                <label>Or Upload Logo Image</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <img id="settingLogoImgPreview" src=""
                                        style="width: 40px; height: 40px; object-fit: contain; border-radius: 4px; display: none;">
                                    <input type="file" id="settingLogoUpload" accept="image/*">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Store Location Text (Topbar)</label>
                                <input type="text" id="settingLocation" placeholder="e.g. Chunian, Punjab, Pakistan">
                            </div>
                        </div>

                        <!-- Hero & Contact Settings Panel -->
                        <div class="panel">
                            <div class="panel-header">
                                <h3 class="panel-title">Hero & Contact Info</h3>
                            </div>
                            <div class="form-group">
                                <label>Hero Title (Use &lt;span class="text-highlight"&gt; for gold text)</label>
                                <input type="text" id="settingHeroTitle" placeholder="e.g. Complete School Books...">
                            </div>
                            <div class="form-group">
                                <label>Hero Subtitle</label>
                                <textarea id="settingHeroSubtitle" rows="3"
                                    style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); font-family: inherit; resize: vertical;"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Phone Number (WhatsApp)</label>
                                    <input type="text" id="settingPhone" placeholder="e.g. +92 300 1234567">
                                </div>
                                <div class="form-group">
                                    <label>Email Address</label>
                                    <input type="email" id="settingEmail" placeholder="e.g. info@alqalam.com.pk">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Footer Physical Address</label>
                                <input type="text" id="settingAddress" placeholder="e.g. Main Bazaar, Chunian">
                            </div>
                            <div class="form-group">
                                <label>Business Hours</label>
                                <input type="text" id="settingHours" placeholder="e.g. Mon - Sat: 9:00 AM - 9:00 PM">
                            </div>
                        </div>
                    </div>
                    <!-- Save Button Block -->
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; max-width: 300px;"><i
                                class="fa-solid fa-floppy-disk"></i> Save All Settings</button>
                    </div>
                </form>
            </div>

            <!-- About Us View -->
            <div id="about-us-view" class="view-section">
                <div class="panel" style="max-width: 800px;">
                    <div class="panel-header">
                        <h3 class="panel-title">Edit About Us Section</h3>
                    </div>
                    <form class="admin-form" id="aboutUsForm">
                        <div class="form-group">
                            <label>Owner Image</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <img id="ownerImagePreview"
                                    src="https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
                                    style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                <input type="file" id="ownerImageUpload" accept="image/*">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>About Us Text (Paragraphs are supported)</label>
                            <textarea id="aboutUsInput" rows="12" placeholder="Enter details about your store..."
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); font-family: inherit; resize: vertical;"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Data Mocks
        // Admin Product Data
        function getAdminProducts() {
            const stored = localStorage.getItem('alqalam_products');
            if (stored) return JSON.parse(stored);

            const defaultProducts = [
                { id: 'p1', title: 'Complete 9th Class Science Set (PTB)', category: 'school', price: 4500, oldPrice: 5000, stock: 45, img: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', badge: 'Best Seller' },
                { id: 'p2', title: 'FSc Part 1 Physics (Punjab Text Book)', category: 'college', price: 850, oldPrice: null, stock: 12, img: 'https://images.unsplash.com/photo-1614036417651-efe5912149d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', badge: null },
                { id: 'p3', title: 'Premium Geometry Box', category: 'stationery', price: 450, oldPrice: 550, stock: 150, img: 'https://images.unsplash.com/photo-1594246830573-05b1c57e62d4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', badge: 'Sale 18% Off' },
                { id: 'p4', title: '10th Class Mathematics (Science Group)', category: 'school', price: 650, oldPrice: null, stock: 30, img: 'https://images.unsplash.com/photo-1509228468518-180dd4864904?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80', badge: null }
            ];
            localStorage.setItem('alqalam_products', JSON.stringify(defaultProducts));
            return defaultProducts;
        }

        let adminProducts = getAdminProducts();

        function saveAdminProducts() {
            localStorage.setItem('alqalam_products', JSON.stringify(adminProducts));
            renderAdminInventory();
        }

        // Admin Orders Data
        function getAdminOrders() {
            const stored = localStorage.getItem('alqalam_orders');
            if (stored) return JSON.parse(stored);

            // Generate some mock orders if none exist
            const mockOrders = [
                { id: '#ORD-1001', name: 'Zainab Bibi', date: new Date().toISOString(), city: 'Chunian', total: 4500, status: 'Pending', statusClass: 'status-pending' },
                { id: '#ORD-1002', name: 'Ali Hasan', date: new Date().toISOString(), city: 'Pattoki', total: 1250, status: 'Completed', statusClass: 'status-completed' },
            ];
            localStorage.setItem('alqalam_orders', JSON.stringify(mockOrders));
            return mockOrders;
        }

        let adminOrders = getAdminOrders();

        function saveAdminOrders() {
            localStorage.setItem('alqalam_orders', JSON.stringify(adminOrders));
            renderOrders();
        }

        const mockCustomers = [
            { name: 'Zainab Bibi', phone: '0300 9876543', city: 'Chunian', orders: 4 },
            { name: 'Ali Hasan', phone: '0301 1234567', city: 'Pattoki', orders: 1 },
            { name: 'Usman Ghani', phone: '0333 4567890', city: 'Chunian', orders: 12 },
        ];

        document.addEventListener('DOMContentLoaded', () => {

            // Navigation Logic
            const navItems = document.querySelectorAll('.nav-item[data-view]');
            const views = document.querySelectorAll('.view-section');
            const pageTitle = document.getElementById('pageTitle');

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    // Update Nav
                    navItems.forEach(n => n.classList.remove('active'));
                    e.currentTarget.classList.add('active');

                    // Update Title mapping
                    const titleMap = {
                        'dashboard': 'Overview',
                        'orders': 'Order Management',
                        'products': 'Inventory Management',
                        'low-stock': 'Low Stock Alerts',
                        'customers': 'Customer Database',
                        'coupons': 'Coupon Codes',
                        'store-settings': 'Store Settings',
                        'about-us': 'About Us Content'
                    };
                    const viewKey = e.currentTarget.getAttribute('data-view');
                    pageTitle.textContent = titleMap[viewKey];

                    // Swap Views
                    views.forEach(v => v.classList.remove('active'));

                    // Route views (simplistic mapping for mock)
                    const targetViewId = ['dashboard', 'products', 'customers', 'coupons', 'store-settings', 'orders', 'about-us'].includes(viewKey)
                        ? `${viewKey}-view`
                        : 'dashboard-view'; // default fallback for unbuilt views

                    document.getElementById(targetViewId).classList.add('active');
                });
            });

            // Populate Tables
            window.renderOrders = function () {
                // Recent Orders (Dashboard)
                const recentOrders = adminOrders.slice(0, 5);
                document.getElementById('recentOrdersTable').innerHTML = recentOrders.map(o => `
                    <tr>
                        <td><strong>${o.id}</strong></td>
                        <td>${o.name}</td>
                        <td><span class="status-badge ${o.statusClass || (o.status === 'Completed' ? 'status-completed' : 'status-pending')}">${o.status}</span></td>
                    </tr>
                `).join('');

                // All Orders (Orders View)
                const allOrdersTable = document.getElementById('allOrdersTable');
                if (allOrdersTable) {
                    allOrdersTable.innerHTML = adminOrders.map(o => `
                        <tr>
                            <td><strong>${o.id}</strong></td>
                            <td>${new Date(o.date).toLocaleDateString()}</td>
                            <td>${o.name}</td>
                            <td>${o.city}</td>
                            <td>Rs ${o.total.toLocaleString()}</td>
                            <td><span class="status-badge ${o.statusClass || (o.status === 'Completed' ? 'status-completed' : 'status-pending')}">${o.status}</span></td>
                            <td>
                                ${o.status !== 'Completed' ? `<button class="action-btn" onclick="markOrderComplete('${o.id}')" title="Mark Completed"><i class="fa-solid fa-check" style="color: var(--primary-green);"></i></button>` : ''}
                                <button class="action-btn" style="color:#E74C3C;" onclick="deleteOrder('${o.id}')" title="Delete Order"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                    `).join('');
                }

                // Update Dashboard Stats
                const pendingCount = adminOrders.filter(o => o.status === 'Pending').length;

                const totalOrdersEl = document.getElementById('dashboardTotalOrders');
                if (totalOrdersEl) totalOrdersEl.textContent = adminOrders.length;

                const pendingOrdersEl = document.getElementById('dashboardPendingOrders');
                if (pendingOrdersEl) pendingOrdersEl.textContent = pendingCount;
            };

            window.markOrderComplete = function (id) {
                const order = adminOrders.find(o => o.id === id);
                if (order) {
                    order.status = 'Completed';
                    order.statusClass = 'status-completed';
                    saveAdminOrders();
                }
            };

            window.deleteOrder = function (id) {
                if (confirm('Are you sure you want to delete this order?')) {
                    adminOrders = adminOrders.filter(o => o.id !== id);
                    saveAdminOrders();
                }
            };

            renderOrders();

            window.renderAdminInventory = function () {
                document.getElementById('inventoryTable').innerHTML = adminProducts.map(i => `
                    <tr>
                        <td>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <img src="${i.img}" style="width: 40px; height: 40px; border-radius: 4px; object-fit: cover;">
                                <strong>${i.title}</strong>
                            </div>
                        </td>
                        <td style="text-transform: capitalize;">${i.category}</td>
                        <td>Rs ${i.price}</td>
                        <td><span class="status-badge ${i.stock < 10 ? 'status-low' : 'status-completed'}">${i.stock} units</span></td>
                        <td>
                            <button class="action-btn" onclick="editProduct('${i.id}')"><i class="fa-solid fa-pen-to-square"></i></button>
                            <button class="action-btn" style="color:#E74C3C;" onclick="deleteProduct('${i.id}')"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('');

                // Stats update for low stock
                const lowStockCount = adminProducts.filter(p => p.stock < 10).length;
                const lowStockElem = document.querySelector('.icon-red');
                if (lowStockElem) {
                    const valElem = lowStockElem.previousElementSibling.querySelector('.value');
                    if (valElem) valElem.textContent = lowStockCount;
                }
            };

            renderAdminInventory();

            document.getElementById('customersTable').innerHTML = mockCustomers.map(c => `
                <tr>
                    <td><strong>${c.name}</strong></td>
                    <td>${c.phone}</td>
                    <td>${c.city}</td>
                    <td>${c.orders}</td>
                </tr>
            `).join('');

            // Init Chart.js
            const ctx = document.getElementById('salesChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Sales Revenue (Rs)',
                        data: [12000, 19000, 15000, 25000, 22000, 30000, 45500],
                        borderColor: '#27AE60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#E5E8E8' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Product Modal Logic
            window.openProductModal = function () {
                document.getElementById('productForm').reset();
                document.getElementById('prodId').value = '';
                document.getElementById('productModalTitle').textContent = 'Add Product';
                document.getElementById('productModal').style.display = 'flex';
            };

            window.closeProductModal = function () {
                document.getElementById('productModal').style.display = 'none';
            };

            window.editProduct = function (id) {
                const p = adminProducts.find(x => x.id === id);
                if (!p) return;
                document.getElementById('prodId').value = p.id;
                document.getElementById('prodTitle').value = p.title;
                document.getElementById('prodCategory').value = p.category;
                document.getElementById('prodPrice').value = p.price;
                document.getElementById('prodOldPrice').value = p.oldPrice || '';
                document.getElementById('prodStock').value = p.stock || 0;
                document.getElementById('prodImg').value = p.img;
                document.getElementById('prodBadge').value = p.badge || '';
                document.getElementById('productModalTitle').textContent = 'Edit Product';
                document.getElementById('productModal').style.display = 'flex';
            };

            window.deleteProduct = function (id) {
                if (confirm('Are you sure you want to delete this product?')) {
                    adminProducts = adminProducts.filter(x => x.id !== id);
                    saveAdminProducts();
                }
            };

            document.getElementById('productForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const id = document.getElementById('prodId').value;
                const newProd = {
                    id: id || 'p' + Date.now(),
                    title: document.getElementById('prodTitle').value,
                    category: document.getElementById('prodCategory').value,
                    price: parseInt(document.getElementById('prodPrice').value) || 0,
                    oldPrice: parseInt(document.getElementById('prodOldPrice').value) || null,
                    stock: parseInt(document.getElementById('prodStock').value) || 0,
                    img: document.getElementById('prodImg').value,
                    badge: document.getElementById('prodBadge').value || null
                };

                if (id) {
                    const idx = adminProducts.findIndex(x => x.id === id);
                    if (idx > -1) adminProducts[idx] = newProd;
                } else {
                    adminProducts.push(newProd);
                }
                saveAdminProducts();
                closeProductModal();
            });

            // ============================================
            // Store Settings (Full Customization)
            // ============================================
            const storeSettingsForm = document.getElementById('storeSettingsForm');

            // 1. Load existing settings into inputs
            let siteSettings = JSON.parse(localStorage.getItem('alqalam_site_settings')) || {
                announcement: '',
                logoPrimary: 'Al Qalam',
                logoSecondary: 'Book Center',
                logoImg: '',
                location: 'Chunian, Punjab, Pakistan',
                heroTitle: 'Complete School & College Books <span class="text-highlight">Under One Roof</span>',
                heroSubtitle: 'Your trusted local partner in Chunian for premium quality stationery, school textbooks, and complete class sets. Fast delivery & cash on delivery available.',
                phone: '+92 300 1234567',
                email: 'info@alqalam.com.pk',
                address: 'Main Bazaar, Chunian',
                hours: 'Mon - Sat: 9:00 AM - 9:00 PM'
            };

            // Populate form
            if (storeSettingsForm) {
                document.getElementById('settingAnnouncement').value = localStorage.getItem('alqalam_announcement') || siteSettings.announcement; // legacy fallback
                document.getElementById('settingLogoPrimary').value = siteSettings.logoPrimary;
                document.getElementById('settingLogoSecondary').value = siteSettings.logoSecondary;
                document.getElementById('settingLocation').value = siteSettings.location;
                document.getElementById('settingHeroTitle').value = siteSettings.heroTitle;
                document.getElementById('settingHeroSubtitle').value = siteSettings.heroSubtitle;
                document.getElementById('settingPhone').value = siteSettings.phone;
                document.getElementById('settingEmail').value = siteSettings.email;
                document.getElementById('settingAddress').value = siteSettings.address;
                document.getElementById('settingHours').value = siteSettings.hours;

                if (siteSettings.logoImg) {
                    const prev = document.getElementById('settingLogoImgPreview');
                    prev.src = siteSettings.logoImg;
                    prev.style.display = 'block';
                }

                // Handle Image Upload for Logo
                document.getElementById('settingLogoUpload').addEventListener('change', function (e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            siteSettings.logoImg = e.target.result;
                            const prev = document.getElementById('settingLogoImgPreview');
                            prev.src = siteSettings.logoImg;
                            prev.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // 2. Save settings
                storeSettingsForm.addEventListener('submit', (e) => {
                    e.preventDefault();

                    siteSettings.announcement = document.getElementById('settingAnnouncement').value;

                    // Keep legacy variable alive just in case
                    localStorage.setItem('alqalam_announcement', siteSettings.announcement);

                    siteSettings.logoPrimary = document.getElementById('settingLogoPrimary').value;
                    siteSettings.logoSecondary = document.getElementById('settingLogoSecondary').value;
                    siteSettings.location = document.getElementById('settingLocation').value;
                    siteSettings.heroTitle = document.getElementById('settingHeroTitle').value;
                    siteSettings.heroSubtitle = document.getElementById('settingHeroSubtitle').value;
                    siteSettings.phone = document.getElementById('settingPhone').value;
                    siteSettings.email = document.getElementById('settingEmail').value;
                    siteSettings.address = document.getElementById('settingAddress').value;
                    siteSettings.hours = document.getElementById('settingHours').value;

                    localStorage.setItem('alqalam_site_settings', JSON.stringify(siteSettings));
                    alert('Store settings saved successfully!');
                });
            }
            // About Us and Owner Image Setup
            const aboutUsInput = document.getElementById('aboutUsInput');
            const ownerImageUpload = document.getElementById('ownerImageUpload');
            const ownerImagePreview = document.getElementById('ownerImagePreview');

            let currentOwnerImage = localStorage.getItem('alqalam_owner_image') || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';

            if (aboutUsInput) {
                aboutUsInput.value = localStorage.getItem('alqalam_about_us') || '';
            }
            if (ownerImagePreview) {
                ownerImagePreview.src = currentOwnerImage;
            }

            if (ownerImageUpload) {
                ownerImageUpload.addEventListener('change', function (e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            currentOwnerImage = e.target.result;
                            if (ownerImagePreview) ownerImagePreview.src = currentOwnerImage;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            const abtForm = document.getElementById('aboutUsForm');
            if (abtForm) {
                abtForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (aboutUsInput) localStorage.setItem('alqalam_about_us', aboutUsInput.value);
                    localStorage.setItem('alqalam_owner_image', currentOwnerImage);
                    alert('About Us & Owner Image saved!');
                });
            }
        });
    </script>
</body>

</html>